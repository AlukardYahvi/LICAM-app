<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Riesgo Cardiometabólico y Hepático (MASLD)</title>
    <!-- Carga de Tailwind CSS para estilos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para la tesis */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        /* Paleta de riesgo */
        .risk-low { background-color: #d1fae5; color: #065f46; border-color: #34d399; }
        .risk-moderate { background-color: #fef3c7; color: #92400e; border-color: #fcd34d; }
        .risk-high { background-color: #fee2e2; color: #991b1b; border-color: #f87171; }
        /* IPN/ESM Accent (Guinda/Maroon equivalent) */
        .ipn-accent { color: #b91c1c; } 
        .ipn-border { border-color: #b91c1c; } /* red-700 */
        .ipn-bg { background-color: #b91c1c; }
        .shadow-glow {
            box-shadow: 0 0 15px rgba(185, 28, 28, 0.3); /* Guinda glow */
        }

        /* Estilos para el mensaje flotante (Google Sheets Status) */
        #licam-msg {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 14px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            font-weight: 500;
            z-index: 9999;
            display: none;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Mensaje Flotante de Google Sheets -->
    <div id="licam-msg" style="display: none;"></div>

    <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-2xl border-t-8 ipn-border">
        <header class="text-center mb-8">
            <!-- Logos Section -->
            <div class="flex justify-center items-center space-x-6 mb-4">
                <a href="https://www.esm.ipn.mx/" target="_blank" title="Escuela Superior de Medicina - IPN">
                    <!-- Placeholder ESM/IPN Logo -->
                    <img src="https://placehold.co/80x80/b91c1c/ffffff?text=ESM" alt="Logo ESM" class="h-16 w-16 object-contain rounded-full shadow-md">
                </a>
                <a href="https://www.ipn.mx/" target="_blank" title="Instituto Politécnico Nacional">
                    <!-- Placeholder IPN Logo -->
                    <img src="https://placehold.co/100x100/7c0000/ffffff?text=IPN" alt="Logo IPN" class="h-20 w-20 object-contain shadow-lg">
                </a>
                 <a href="cemiztli.wixsite.com/cardiometabolismo" target="_blank" title="Laboratorio LICAM">
                    <!-- Placeholder LICAM Logo -->
                    <img src="https://placehold.co/80x80/374151/ffffff?text=LICAM" alt="Logo LICAM" class="h-16 w-16 object-contain rounded-full shadow-md">
                </a>
            </div>
            <!-- End Logos Section -->
            
            <h1 class="text-3xl md:text-4xl font-bold ipn-accent">
                Calculadora de Riesgo Cardiometabólico y Hepático (MASLD)
            </h1>
            <p class="text-lg text-gray-700 mt-2">
                Proyecto de Tesis - Ingeniería en Biotecnología
            </p>
            <p class="mt-1 text-sm text-gray-500">
                Herramienta desarrollada en colaboración con el IPN.
            </p>
        </header>

        <!-- Formulario de Entrada de Datos -->
        <div id="input-form">
            <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">1. Datos Básicos y Antropometría</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Sexo -->
                <div>
                    <label for="gender" class="block text-sm font-medium text-gray-700">Sexo</label>
                    <select id="gender" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm rounded-md shadow-sm">
                        <option value="male">Masculino</option>
                        <option value="female">Femenino</option>
                    </select>
                </div>
                <!-- Edad -->
                <div>
                    <label for="age" class="block text-sm font-medium text-gray-700">Edad (años)</label>
                    <input type="number" id="age" value="35" min="18" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                <!-- Altura -->
                <div>
                    <label for="height" class="block text-sm font-medium text-gray-700">Estatura (cm)</label>
                    <input type="number" id="height" value="175" min="100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                <!-- Peso -->
                <div>
                    <label for="weight" class="block text-sm font-medium text-gray-700">Peso (kg)</label>
                    <input type="number" id="weight" value="85" min="30" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                <!-- Perímetro Abdominal -->
                <div>
                    <label for="waist" class="block text-sm font-medium text-gray-700">Cintura (cm)</label>
                    <input type="number" id="waist" value="95" min="50" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                    <p id="waist-note" class="mt-1 text-xs text-gray-500 italic"></p>
                </div>
            </div>

            <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">2. Parámetros Bioquímicos</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Glucemia -->
                <div>
                    <label for="glucose" class="block text-sm font-medium text-gray-700">Glucemia Ayunas (mg/dL)</label>
                    <input type="number" id="glucose" value="110" min="40" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                <!-- Triglicéridos -->
                <div>
                    <label for="triglycerides" class="block text-sm font-medium text-gray-700">Triglicéridos (mg/dL)</label>
                    <input type="number" id="triglycerides" value="180" min="20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                <!-- HDL -->
                <div>
                    <label for="hdl" class="block text-sm font-medium text-gray-700">Colesterol HDL (mg/dL)</label>
                    <input type="number" id="hdl" value="35" min="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                 <!-- PAS -->
                 <div>
                    <label for="pas" class="block text-sm font-medium text-gray-700">Presión Sistólica (mmHg)</label>
                    <input type="number" id="pas" value="135" min="80" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
                 <!-- PAD -->
                 <div>
                    <label for="pad" class="block text-sm font-medium text-gray-700">Presión Diastólica (mmHg)</label>
                    <input type="number" id="pad" value="85" min="40" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                </div>
            </div>
            
            <!-- Mediciones Adicionales de PA (Opcional) -->
            <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-1">2.1. Promedio PA (Opcional - 3 Días)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- PA DÍA 1 -->
                <div>
                    <label for="pa_d1_s" class="block text-sm font-medium text-gray-700">PA Día 1 S/D (mmHg)</label>
                    <div class="flex space-x-2">
                        <input type="number" id="pa_d1_s" placeholder="Sistólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                        <input type="number" id="pa_d1_d" placeholder="Diastólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>
                 <!-- PA DÍA 2 -->
                <div>
                    <label for="pa_d2_s" class="block text-sm font-medium text-gray-700">PA Día 2 S/D (mmHg)</label>
                    <div class="flex space-x-2">
                        <input type="number" id="pa_d2_s" placeholder="Sistólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                        <input type="number" id="pa_d2_d" placeholder="Diastólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>
                 <!-- PA DÍA 3 -->
                <div>
                    <label for="pa_d3_s" class="block text-sm font-medium text-gray-700">PA Día 3 S/D (mmHg)</label>
                    <div class="flex space-x-2">
                        <input type="number" id="pa_d3_s" placeholder="Sistólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                        <input type="number" id="pa_d3_d" placeholder="Diastólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <p class="mt-1 text-xs text-gray-500 italic">Usar para mayor confiabilidad (opcional).</p>
                </div>
            </div>

            <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">3. Estilo de Vida y Recolección de Datos</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <!-- Correo Electrónico -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Correo Electrónico</label>
                    <input type="email" id="email" placeholder="ejemplo@correo.com" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                    <p class="mt-1 text-xs text-gray-500 italic">Solo para envío de resultados.</p>
                </div>
                 <!-- Actividad Física -->
                 <div>
                    <label for="activity" class="block text-sm font-medium text-gray-700">Actividad Física (&ge; 30 min/día)</label>
                    <select id="activity" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm rounded-md shadow-sm">
                        <option value="yes">Sí (30 min/día)</option>
                        <option value="no">No o Menos</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500 italic">Factor protector: 150 min/semana.</p>
                </div>
                <!-- Historia Familiar ECV/DM -->
                <div>
                    <label for="family_history" class="block text-sm font-medium text-gray-700">Historia Familiar ECV/DM</label>
                    <select id="family_history" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 rounded-md">
                        <option value="no">No</option>
                        <option value="yes">Sí (Padres/Hermanos)</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500 italic">Enfermedad Cardiovascular o Diabetes Mellitus.</p>
                </div>
                <!-- Tabaquismo -->
                <div>
                    <label for="smoker" class="block text-sm font-medium text-gray-700">Tabaquismo</label>
                    <select id="smoker" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm rounded-md shadow-sm">
                        <option value="never">Nunca Fumador</option>
                        <option value="ex_smoker">Ex Fumador</option>
                        <option value="occasional">Fumador Ocasional</option>
                        <option value="actual">Fumador Actual</option>
                    </select>
                </div>
                <!-- Consumo Azúcares -->
                <div>
                    <label for="sugar_intake" class="block text-sm font-medium text-gray-700">Consumo Diario de BAA</label>
                    <select id="sugar_intake" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 rounded-md">
                        <option value="no">No o Rara Vez</option>
                        <option value="yes">Sí (Refrescos/Jugos)</option>
                    </select>
                    <p class="mt-1 text-xs text-gray-500 italic">Bebidas Azucaradas Añadidas (BAA).</p>
                </div>
            </div>

            <button onclick="calculateRisk()" class="w-full mt-4 py-3 px-6 border border-transparent rounded-lg shadow-glow text-lg font-medium text-white ipn-bg hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                Calcular Riesgo Cardiometabólico y Hepático
            </button>
        </div>

        <!-- Sección de Resultados (Oculta inicialmente) -->
        <div id="results-section" class="hidden mt-10">
            <h2 class="text-3xl font-bold ipn-accent mb-6 border-b-4 ipn-border pb-3">4. Resultados y Plan de Acción</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                <!-- Resumen de Riesgo -->
                <div class="p-6 rounded-xl border-2">
                    <h3 class="text-xl font-semibold mb-3 ipn-accent flex items-center">
                        <svg class="w-6 h-6 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                        Riesgo Global Evaluado
                    </h3>
                    <div id="rcm-result" class="text-center p-4 rounded-lg font-bold text-2xl mb-4 transition duration-300"></div>
                    <div id="mahld-result" class="text-center p-4 rounded-lg font-bold text-2xl mb-4 transition duration-300"></div>
                    
                    <div class="text-sm text-gray-600">
                        <p class="mt-2"><span class="font-semibold text-gray-700">IMC Calculado:</span> <span id="bmi-val"></span> <span id="bmi-class" class="font-bold"></span></p>
                        <p><span class="font-semibold text-gray-700">Criterios de SM (Cumplidos):</span> <span id="sm-count"></span>/5</p>
                        <p><span class="font-semibold text-gray-700">Puntaje IHG (MASLD):</span> <span id="fli-score"></span> (Alto riesgo si > 60)</p>
                    </div>
                </div>

                <!-- Factores Contribuyentes -->
                <div class="p-6 rounded-xl border-2 bg-gray-50">
                    <h3 class="text-xl font-semibold mb-3 ipn-accent flex items-center">
                        <svg class="w-6 h-6 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.018A9.001 9.001 0 0120.975 18H3.025a9.001 9.001 0 0113.882-10.426M12 2v20"></path></svg>
                        Factores Clave
                    </h3>
                    <ul id="risk-factors-list" class="space-y-2 text-sm text-gray-700">
                        <!-- Lista generada por JS -->
                    </ul>
                </div>
            </div>

            <!-- Botones de Recolección de Datos -->
            <div class="mt-8">
                <button onclick="copyResults()" class="w-full py-2 px-4 border border-green-600 rounded-lg shadow-sm text-sm font-medium text-white bg-green-500 hover:bg-green-600 transition duration-150 ease-in-out">
                    Copiar Resultados y Recomendaciones
                </button>
            </div>

            <!-- Recomendaciones -->
            <div class="mt-8 p-6 rounded-xl border-2 border-green-500 bg-green-50">
                <h3 class="text-2xl font-bold mb-4 text-green-700 flex items-center">
                    <svg class="w-7 h-7 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0h6"></path></svg>
                    Plan de Acción Personalizado
                </h3>
                <ul id="recommendations-list" class="space-y-3 text-gray-800 list-disc ml-5">
                    <!-- Recomendaciones generadas por JS -->
                </ul>
            </div>

             <!-- Descargo de Responsabilidad -->
             <div class="mt-8 text-center border-t pt-4">
                <p class="text-xs text-gray-500 italic">**Nota Importante:** Esta herramienta es parte de un proyecto de tesis y no sustituye la evaluación médica profesional. Consulte a su médico para un diagnóstico y tratamiento precisos.</p>
            </div>
        </div>
        
        <!-- Separator -->
        <div class="border-t pt-4 mt-8"></div> 

        <!-- Información del Proyecto y Colaboradores -->
        <div id="project-info" class="p-4 bg-gray-50 rounded-lg text-sm">
            <h3 class="font-bold text-lg ipn-accent mb-2 border-b pb-1">Información del Proyecto y Colaboradores</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <p class="font-semibold text-gray-700">Presenta y Asesoría:</p>
                    <p class="text-gray-600"><strong>Edsel Yahvi Méndez Hernández</strong></p>
                    <p class="text-gray-600">Asesora Externa: Dra. Nayelli Nájera García</p>
                    <p class="text-gray-600">Asesor Interno (Docente): Dr. Bustos García Juan Roberto Israel</p>
                    <p class="font-semibold text-gray-700 mt-2">Institución:</p>
                    <p class="text-gray-600">
                        <a href="https://www.esm.ipn.mx/" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                            Escuela Superior de Medicina (ESM) - IPN
                        </a>
                    </p>
                </div>
                <div>
                    <p class="font-semibold text-gray-700">Laboratorio Colaborador (LICAM):</p>
                    <p class="text-gray-600">Investigación Integral Cardiometabólica (IPN)</p>
                    
                    <p class="font-semibold text-gray-700 mt-2">Contacto y Ubicación:</p>
                    <p class="text-gray-600">
                        <span class="font-medium">Ubicación:</span> Plan de San Luis y Díaz Mirón s/n Col. Casco de Santo Tomás, Miguel Hidalgo, 11340, Ciudad de México, CDMX.
                    </p>
                    <p class="text-gray-600">
                        <span class="font-medium">Correo:</span> nnajerag@ipn.mx
                    </p>
                    <p class="text-gray-600">
                        <span class="font-medium">Teléfono:</span> 55 5729 6300 ext 62820
                    </p>
                    <p class="text-gray-600 mt-2">
                         <span class="font-medium">Sitio Web/Redes:</span> 
                         <a href="cemiztli.wixsite.com/cardiometabolismo" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                            cemiztli.wixsite.com/cardiometabolismo
                        </a>,
                        <a href="https://www.facebook.com/licam.ipn" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                            Facebook
                        </a>,
                        <a href="https://www.instagram.com/ipn_licam_lab" target="_blank" class="text-pink-600 hover:text-pink-800 font-semibold underline">
                            Instagram
                        </a>
                    </p>
                </div>
            </div>
        </div>
    </div>
<script>
/* =======================================================
   ========== GOOGLE SHEETS & DATA RECOLLECTION ==========
   ======================================================= */

// ✅ URL de tu Apps Script desplegado
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyhDKex6-s2WO9sDuIHcYzI_rJfVjuWAUTs4fM-vgEEmdeSbdK6UEUi4cv8SEfAd0A/exec";

/**
 * Muestra un mensaje visual en pantalla (verde = éxito, rojo = error)
 */
function mostrarMensaje(texto, esError = false) {
  let msg = document.getElementById('licam-msg');
  if (!msg) {
    msg = document.createElement('div');
    msg.id = 'licam-msg';
    msg.style.position = 'fixed';
    msg.style.bottom = '20px';
    msg.style.right = '20px';
    msg.style.padding = '10px 14px';
    msg.style.borderRadius = '8px';
    msg.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
    msg.style.fontWeight = '500';
    msg.style.zIndex = 9999;
    document.body.appendChild(msg);
  }
  msg.style.background = esError ? '#f8d7da' : '#d1e7dd';
  msg.style.color = esError ? '#842029' : '#0f5132';
  msg.textContent = texto;
  msg.style.display = 'block';
  clearTimeout(msg._timeoutId);
  msg._timeoutId = setTimeout(() => msg.style.display = 'none', 4000);
}

/**
 * Envía los datos generados al Apps Script → Google Sheets
 */
async function guardarDatos(datos) {
  try {
    const response = await fetch(SCRIPT_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(datos)
    });

    if (!response.ok) throw new Error("Respuesta no válida del servidor");
    mostrarMensaje("✅ Datos enviados correctamente a la base de datos.");
  } catch (err) {
    console.error("Error al guardar datos:", err);
    mostrarMensaje("⚠️ No se pudieron guardar los datos. Revisa la conexión.", true);
  }
}

/**
 * Envía automáticamente los resultados del cálculo a Google Sheets
 * después de ejecutar calculateRisk()
 */
const originalCalculateRisk = window.calculateRisk;
window.calcula
</body>
</html>


