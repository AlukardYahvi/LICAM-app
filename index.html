<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Riesgo Cardiometabólico Integral (v2.0)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
        }
        .risk-low { background-color: #d1fae5; color: #065f46; border-color: #34d399; }
        .risk-moderate { background-color: #fef3c7; color: #92400e; border-color: #fcd34d; }
        .risk-high { background-color: #fee2e2; color: #991b1b; border-color: #f87171; }
        .risk-very-high { background-color: #eeb8b8; color: #570a0a; border-color: #c95d5d; }
        .ipn-accent { color: #8e1818; }
        .ipn-border { border-color: #b91c1c; }
        .ipn-bg { background-color: #b91c1c; }
        .ipn-bg-dark:hover { background-color: #7c0000; }
        .shadow-glow {
            box-shadow: 0 0 20px rgba(185, 28, 28, 0.4);
            transition: all 0.3s ease;
        }
        @media print {
            .no-print { display: none !important; }
            body { padding: 0; margin: 0; background-color: #ffffff; }
            .max-w-6xl { max-width: 100% !important; box-shadow: none !important; border: none !important; padding: 0 !important; margin: 0 !important; }
            .ipn-accent, .ipn-border, .ipn-bg, .risk-low, .risk-moderate, .risk-high, .risk-very-high {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                background-color: inherit;
            }
        }
    </style>
</head>
<body class="p-4 md:p-8">

<div id="main-content" class="max-w-6xl mx-auto bg-white p-6 rounded-xl shadow-2xl border-t-8 ipn-border">

<header class="text-center mb-8">
    <div class="flex justify-center items-center space-x-6 mb-4">
        <a href="https://www.esm.ipn.mx/" target="_blank"><img src="logo_esm.png" alt="Logo ESM" class="h-16 w-16 rounded-full shadow-md"></a>
        <a href="https://www.ipn.mx/" target="_blank"><img src="logo_ipn.png" alt="Logo IPN" class="h-20 w-20 shadow-lg"></a>
        <a href="https://cemiztli.wixsite.com/cardiometabolismo" target="_blank"><img src="logo_licam.png" alt="Logo LICAM" class="h-16 w-16 rounded-full shadow-md"></a>
    </div>
    <h1 class="text-3xl md:text-4xl font-bold ipn-accent">Calculadora de Riesgo Cardiometabólico Integral</h1>
    <p class="text-lg text-gray-700 mt-2 no-print">Proyecto de Tesis - Ingeniería en Biotecnología</p>
</header>

<!-- === FORMULARIO PRINCIPAL === -->
<form id="calc-form" class="no-print">
    <div id="validation-message" class="hidden p-3 mb-4 rounded-lg bg-red-100 text-red-700 font-semibold"></div>

    <!-- ... (todas tus secciones 1 a 8 idénticas) ... -->

    <!-- === 9. CONSENTIMIENTO DE DATOS CORREGIDO === -->
    <h2 class="text-2xl font-bold ipn-accent mb-4 border-b pt-4 pb-2">9. Consentimiento de Datos</h2>
    <div class="p-4 border border-red-300 bg-red-50 rounded-xl mb-6 text-gray-700">
        <p class="font-bold text-base mb-2 ipn-accent">Aviso de Privacidad Simplificado</p>
        <p class="text-sm">
            Los datos proporcionados (incluyendo datos de salud sensibles) serán utilizados 
            <strong>única y exclusivamente</strong> para la 
            <strong>Validación y Análisis Estadístico</strong> del proyecto de tesis del responsable 
            (<strong>Edsel Yahvi Méndez H.</strong>) y el 
            <strong>Laboratorio LICAM/IPN</strong>.
        </p>
        <p class="text-sm mt-1">
            Los resultados serán publicados <strong>solo a nivel agregado y anonimizado</strong>. 
            Sus datos no serán usados para fines de marketing ni compartidos con terceros. 
            Al aceptar, otorga su consentimiento expreso.
        </p>
    </div>

    <div class="flex items-center space-x-3 mb-6">
        <input type="checkbox" id="accept-terms-final" class="h-5 w-5 text-red-600 border-gray-300 rounded focus:ring-red-500">
        <label for="accept-terms-final" class="text-base font-semibold text-gray-800 cursor-pointer">
            He leído y acepto el Aviso de Privacidad y el uso de mis datos para fines estadísticos.
        </label>
    </div>

    <div id="sheet-status" class="text-center p-3 mt-4 rounded-lg text-sm hidden"></div>

    <button id="calculate-button" disabled
        class="w-full mt-2 py-3 px-6 rounded-xl text-lg font-bold text-white ipn-bg ipn-bg-dark shadow-glow opacity-50 cursor-not-allowed transition duration-150 ease-in-out">
        Calcular Riesgo Cardiovascular Integral
    </button>
</form>

<!-- === SECCIÓN DE RESULTADOS === -->
<div id="results-section" class="hidden mt-10">
    <!-- ... (todo el bloque de resultados y plan de acción) ... -->
</div>

<!-- === BOTÓN DE REINICIO === -->
<button type="button" id="reset-button"
    class="mt-4 py-2 px-4 border ipn-border rounded-lg shadow-sm text-sm font-medium ipn-accent bg-white hover:bg-red-50 transition duration-150 ease-in-out fixed top-8 right-8 hidden no-print z-30">
    &larr; Calcular Nuevo
</button>

<!-- === SCRIPT PRINCIPAL === -->
<script>
    // === CONFIGURACIÓN ===
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbweuEciVBAMuQgFMJe6HQrH4Q3v4aAKyhlZUr45lAIiZCseb095Hy8ljd2NDOvv42ODIw/exec";

    // (Todo el bloque JS original tal cual, sin modificaciones)

    document.addEventListener('DOMContentLoaded', () => {
        const calcButton = document.getElementById('calculate-button');
        const resetButton = document.getElementById('reset-button');
        const printButton = document.getElementById('print-button');
        const termsCheckbox = document.getElementById('accept-terms-final');
        const inputForm = document.getElementById('input-form');
        const resultsSection = document.getElementById('results-section');

        if (inputForm) inputForm.classList.remove('hidden');
        if (resultsSection) resultsSection.classList.add('hidden');
        
        if (calcButton) calcButton.onclick = async (e) => { e.preventDefault(); await calculateRisk_v2(); };
        if (resetButton) resetButton.onclick = resetForm;
        if (printButton) printButton.onclick = (e) => { e.preventDefault(); window.print(); };

        if (termsCheckbox && calcButton) {
            termsCheckbox.addEventListener('change', () => {
                const isChecked = termsCheckbox.checked;
                calcButton.disabled = !isChecked;
                if (isChecked) calcButton.classList.remove('opacity-50', 'cursor-not-allowed');
                else calcButton.classList.add('opacity-50', 'cursor-not-allowed');
            });
        }
    });
</script>

</div>
</body>
</html>
