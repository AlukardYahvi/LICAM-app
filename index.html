<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Riesgo Cardiometabólico Integral (v2.0 Print)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para la tesis */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
        }
        /* Paleta de riesgo */
        .risk-low { background-color: #d1fae5; color: #065f46; border-color: #34d399; }
        .risk-moderate { background-color: #fef3c7; color: #92400e; border-color: #fcd34d; }
        .risk-high { background-color: #fee2e2; color: #991b1b; border-color: #f87171; }
        .risk-very-high { background-color: #eeb8b8; color: #570a0a; border-color: #c95d5d; } /* Color para Muy Alto Riesgo */

        /* IPN/ESM Accent */
        .ipn-accent { color: #b91c1c; } 
        .ipn-border { border-color: #b91c1c; }
        .ipn-bg { background-color: #b91c1c; }
        .shadow-glow {
            box-shadow: 0 0 15px rgba(185, 28, 28, 0.3);
        }

        /* ==== SECCIÓN CSS DE IMPRESIÓN (NUEVA) ==== */
        @media print {
            /* Oculta todo lo que no queremos imprimir */
            .no-print {
                display: none !important;
            }
            
            /* Resetea el cuerpo para imprimir */
            body {
                padding: 0;
                margin: 0;
                background-color: #ffffff;
            }
            
            /* Ajusta el contenedor principal para impresión */
            .max-w-6xl {
                max-width: 100% !important;
                box-shadow: none !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
            }

            /* Asegura que el encabezado y los resultados sean visibles */
            header, #results-section {
                display: block !important;
            }
            
            /* Forzar que los resultados no sean en grid, sino en bloque (mejor para A4) */
            #results-section .grid {
                display: block !important;
            }
            
            /* Asegurar que los colores de riesgo se impriman */
            .risk-low, .risk-moderate, .risk-high, .risk-very-high {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
                background-color: inherit; /* Usa el color definido en la clase */
            }

            /* Oculta los placeholders de imagen en la impresión si no cargan */
            img[src^="https://placehold.co"] {
                display: none;
            }
        }
        /* ==== FIN DE SECCIÓN DE IMPRESIÓN ==== */
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-6xl mx-auto bg-white p-6 rounded-xl shadow-2xl border-t-8 ipn-border">
        
        <header class="text-center mb-8">
            <div class="flex justify-center items-center space-x-6 mb-4">
                <a href="https://www.esm.ipn.mx/" target="_blank" title="Escuela Superior de Medicina - IPN">
                    <img src="https://placehold.co/80x80/b91c1c/ffffff?text=ESM" alt="Logo ESM" class="h-16 w-16 object-contain rounded-full shadow-md">
                </a>
                <a href="https://www.ipn.mx/" target="_blank" title="Instituto Politécnico Nacional">
                    <img src="https://placehold.co/100x100/7c0000/ffffff?text=IPN" alt="Logo IPN" class="h-20 w-20 object-contain shadow-lg">
                </a>
                <a href="cemiztli.wixsite.com/cardiometabolismo" target="_blank" title="Laboratorio LICAM">
                    <img src="https://placehold.co/80x80/374151/ffffff?text=LICAM" alt="Logo LICAM" class="h-16 w-16 object-contain rounded-full shadow-md">
                </a>
            </div>
           
            <h1 class="text-3xl md:text-4xl font-bold ipn-accent">
                Calculadora de Riesgo Cardiometabólico Integral
            </h1>
            <p class="text-lg text-gray-700 mt-2 no-print">
                Proyecto de Tesis - Ingeniería en Biotecnología
            </p>
        </header>

        <form id="calc-form" class="no-print">
            <div id="validation-message" class="hidden p-3 mb-4 rounded-lg bg-red-100 text-red-700 font-semibold"></div>
            <div id="input-form">
               
                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">1. Datos Personales</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label for="full_name" class="block text-sm font-medium text-gray-700">Nombre Completo</label>
                        <input type="text" id="full_name" placeholder="Nombre(s) Apellido(s)" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                    </div>
                    <div>
                        <label for="birth_date" class="block text-sm font-medium text-gray-700">Fecha de Nacimiento</label>
                        <input type="date" id="birth_date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                    </div>
                    <div>
                        <label for="gender" class="block text-sm font-medium text-gray-700">Sexo Biológico</label>
                        <select id="gender" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm rounded-md shadow-sm">
                            <option value="male">Masculino</option>
                            <option value="female">Femenino</option>
                        </select>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-gray-700">Correo Electrónico (Opcional)</label>
                        <input type="email" id="email" placeholder="ejemplo@correo.com" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-red-500 focus:ring-red-500 p-2 border">
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">2. Signos Vitales y Dinamometría</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label for="hr" class="block text-sm font-medium text-gray-700">Frec. Cardíaca (lpm)</label>
                        <input type="number" id="hr" placeholder="60-100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="rr" class="block text-sm font-medium text-gray-700">Frec. Respiratoria (rpm)</label>
                        <input type="number" id="rr" placeholder="12-20" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="grip_right" class="block text-sm font-medium text-gray-700">Fuerza Agarre Der. (Kg)</label>
                        <input type="number" step="0.1" id="grip_right" placeholder="30.5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="grip_left" class="block text-sm font-medium text-gray-700">Fuerza Agarre Izq. (Kg)</label>
                        <input type="number" step="0.1" id="grip_left" placeholder="29.8" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>

                <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-1">2.1. Presión Arterial (Medición Principal)</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label for="pas" class="block text-sm font-medium text-gray-700">Presión Sistólica (mmHg)</label>
                        <input type="number" id="pas" value="120" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="pad" class="block text-sm font-medium text-gray-700">Presión Diastólica (mmHg)</label>
                        <input type="number" id="pad" value="80" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="pa_d2_s" class="block text-sm font-medium text-gray-700">PA Día 2 S/D (Opcional)</label>
                        <div class="flex space-x-2">
                            <input type="number" id="pa_d2_s" placeholder="Sistólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                            <input type="number" id="pa_d2_d" placeholder="Diastólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                    <div>
                        <label for="pa_d3_s" class="block text-sm font-medium text-gray-700">PA Día 3 S/D (Opcional)</label>
                        <div class="flex space-x-2">
                            <input type="number" id="pa_d3_s" placeholder="Sistólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                            <input type="number" id="pa_d3_d" placeholder="Diastólica" class="mt-1 block w-1/2 rounded-md border-gray-300 shadow-sm p-2 border">
                        </div>
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">3. Antropometría</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label for="height" class="block text-sm font-medium text-gray-700">Estatura (cm)</label>
                        <input type="number" id="height" value="170" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="weight" class="block text-sm font-medium text-gray-700">Peso (kg)</label>
                        <input type="number" id="weight" value="75" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="waist" class="block text-sm font-medium text-gray-700">Perímetro Cintura (cm)</label>
                        <input type="number" id="waist" value="90" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="hip" class="block text-sm font-medium text-gray-700">Perímetro Cadera (cm)</label>
                        <input type="number" id="hip" value="100" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">4. Parámetros Bioquímicos</h2>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label for="glucose" class="block text-sm font-medium text-gray-700">Glucosa Ayunas (mg/dL)</label>
                        <input type="number" id="glucose" value="90" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="hba1c" class="block text-sm font-medium text-gray-700">HbA1c (%) (Opcional)</label>
                        <input type="number" step="0.1" id="hba1c" placeholder="5.7" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="total_chol" class="block text-sm font-medium text-gray-700">Colesterol Total (mg/dL)</label>
                        <input type="number" id="total_chol" placeholder="180" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="hdl" class="block text-sm font-medium text-gray-700">Colesterol HDL (mg/dL)</label>
                        <input type="number" id="hdl" value="45" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="ldl" class="block text-sm font-medium text-gray-700">Colesterol LDL (mg/dL)</label>
                        <input type="number" id="ldl" placeholder="110" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="triglycerides" class="block text-sm font-medium text-gray-700">Triglicéridos (mg/dL)</label>
                        <input type="number" id="triglycerides" value="140" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">5. Composición Corporal (Opcional, si usa BIA)</h2>
                <p class="text-sm text-gray-500 -mt-3 mb-3 italic">Llenar solo si tiene datos de una báscula de Bioimpedancia (BIA). Estos campos no se calculan solos.</p>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
                    <div>
                        <label for="bia_fat_p" class="block text-sm font-medium text-gray-700">% Grasa Corporal</label>
                        <input type="number" step="0.1" id="bia_fat_p" placeholder="25.5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="bia_muscle_p" class="block text-sm font-medium text-gray-700">% Músculo</label>
                        <input type="number" step="0.1" id="bia_muscle_p" placeholder="34.0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="bia_visceral_p" class="block text-sm font-medium text-gray-700">% Grasa Visceral</label>
                        <input type="number" step="0.1" id="bia_visceral_p" placeholder="9" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="bia_water_p" class="block text-sm font-medium text-gray-700">% Agua</label>
                        <input type="number" step="0.1" id="bia_water_p" placeholder="55.0" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="bia_metabolic_age" class="block text-sm font-medium text-gray-700">Edad Metabólica</label>
                        <input type="number" id="bia_metabolic_age" placeholder="40" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">6. Estilo de Vida</h2>
                <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-1">6.1. Actividad Física</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="activity_days" class="block text-sm font-medium text-gray-700">Días de ejercicio/semana</label>
                        <select id="activity_days" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="0">0 (Sedentario)</option>
                            <option value="2">1-2 días</option>
                            <option value="3.5">3-4 días</option>
                            <option value="5">5 o más días</option>
                        </select>
                    </div>
                    <div>
                        <label for="activity_duration" class="block text-sm font-medium text-gray-700">Duración promedio (min/día)</label>
                        <input type="number" id="activity_duration" placeholder="30" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="activity_intensity" class="block text-sm font-medium text-gray-700">Intensidad Principal</label>
                        <select id="activity_intensity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="light">Ligera (Caminar)</option>
                            <option value="moderate">Moderada (Trotar, Bici)</option>
                            <option value="vigorous">Vigorosa (Correr, HIIT)</option>
                        </select>
                    </div>
                </div>
                <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-1">6.2. Tabaquismo</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label for="smoker_status" class="block text-sm font-medium text-gray-700">Estado</label>
                        <select id="smoker_status" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="never">Nunca he fumado</option>
                            <option value="ex_smoker">Ex-fumador</option>
                            <option value="active">Fumador Actual</option>
                        </select>
                    </div>
                    <div>
                        <label for="smoker_passive" class="block text-sm font-medium text-gray-700">Fumador Pasivo</label>
                        <select id="smoker_passive" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="no">No</option>
                            <option value="yes">Sí (convive con fumadores)</option>
                        </select>
                    </div>
                    <div>
                        <label for="smoker_years" class="block text-sm font-medium text-gray-700">Años fumando (si aplica)</label>
                        <input type="number" id="smoker_years" placeholder="10" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="smoker_daily_avg" class="block text-sm font-medium text-gray-700">Cigarrillos/día (promedio)</label>
                        <input type="number" id="smoker_daily_avg" placeholder="5" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                </div>
                <h3 class="text-xl font-semibold text-gray-700 mb-3 border-b pb-1">6.3. Consumo de Alcohol</h3>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                    <div>
                        <label for="alcohol_freq" class="block text-sm font-medium text-gray-700">Frecuencia de consumo</label>
                        <select id="alcohol_freq" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="none">Nunca o casi nunca</option>
                            <option value="monthly">1-3 veces al mes</option>
                            <option value="weekly">1-2 veces por semana</option>
                            <option value="daily">Casi diario</option>
                        </select>
                    </div>
                    <div>
                        <label for="alcohol_dose" class="block text-sm font-medium text-gray-700">Dosis (Bebidas estándar/día)</label>
                        <input type="number" id="alcohol_dose" placeholder="2" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                    </div>
                    <div>
                        <label for="alcohol_type" class="block text-sm font-medium text-gray-700">Tipo de alcohol principal</label>
                        <select id="alcohol_type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="beer">Cerveza</option>
                            <option value="wine">Vino</option>
                            <option value="spirit">Destilados (Tequila, Ron, etc.)</option>
                            <option value="mixed">Combinado</option>
                        </select>
                    </div>
                </div>
               
                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">7. Diagnósticos y Tratamiento</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-6">
                    <div class="p-3 border rounded-md bg-gray-50">
                        <label class="block text-base font-semibold text-gray-700">Diabetes Mellitus (DM)</label>
                        <div class="mt-2 space-y-2">
                            <div>
                                <input type="radio" id="dm_no" name="dm_status" value="no" checked> <label for="dm_no">No diagnosticado</label>
                            </div>
                            <div>
                                <input type="radio" id="dm_yes" name="dm_status" value="yes"> <label for="dm_yes">Sí diagnosticado</label>
                            </div>
                            <label for="med_dm" class="block text-sm font-medium text-gray-700 mt-2">¿Toma Metformina, Glibenclamida, Insulina u otro?</label>
                            <select id="med_dm" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="no">No</option>
                                <option value="yes_freq">Sí, frecuentemente</option>
                                <option value="yes_rare">Sí, ocasionalmente</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-3 border rounded-md bg-gray-50">
                        <label class="block text-base font-semibold text-gray-700">Hipertensión (HTA)</label>
                        <div class="mt-2 space-y-2">
                            <div>
                                <input type="radio" id="hta_no" name="hta_status" value="no" checked> <label for="hta_no">No diagnosticado</label>
                            </div>
                            <div>
                                <input type="radio" id="hta_yes" name="hta_status" value="yes"> <label for="hta_yes">Sí diagnosticado</label>
                            </div>
                            <label for="med_hta" class="block text-sm font-medium text-gray-700 mt-2">¿Toma Losartán, Captopril, Amlodipino u otro?</label>
                            <select id="med_hta" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="no">No</option>
                                <option value="yes_freq">Sí, frecuentemente</option>
                                <option value="yes_rare">Sí, ocasionalmente</option>
                            </select>
                        </div>
                    </div>
                    <div class="p-3 border rounded-md bg-gray-50">
                        <label class="block text-base font-semibold text-gray-700">Dislipidemia (Colesterol/TG altos)</label>
                        <div class="mt-2 space-y-2">
                            <div>
                                <input type="radio" id="dlp_no" name="dlp_status" value="no" checked> <label for="dlp_no">No diagnosticado</label>
                            </div>
                            <div>
                                <input type="radio" id="dlp_yes" name="dlp_status" value="yes"> <label for="dlp_yes">Sí diagnosticado</label>
                            </div>
                            <label for="med_dlp" class="block text-sm font-medium text-gray-700 mt-2">¿Toma Estatinas (Atorva, Rosuva) o Fibratos?</label>
                            <select id="med_dlp" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                                <option value="no">No</option>
                                <option value="yes_freq">Sí, frecuentemente</option>
                                <option value="yes_rare">Sí, ocasionalmente</option>
                            </select>
                        </div>
                    </div>
                </div>

                <h2 class="text-2xl font-semibold text-gray-700 mb-4 border-b pb-2">8. Historial Cardiovascular</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label for="history_mi" class="block text-sm font-medium text-gray-700">¿Ha sido diagnosticado con un Infarto?</label>
                        <select id="history_mi" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="no">No</option>
                            <option value="yes">Sí</option>
                        </select>
                    </div>
                    <div>
                        <label for="history_angina" class="block text-sm font-medium text-gray-700">¿Ha sentido dolor opresivo en el pecho al esforzarse (Angina)?</label>
                        <select id="history_angina" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="no">No</option>
                            <option value="yes">Sí</option>
                        </select>
                    </div>
                    <div>
                        <label for="family_history" class="block text-sm font-medium text-gray-700">Antecedentes Familiares (Padres/Hermanos con ECV o DM)</label>
                        <select id="family_history" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="no">No</option>
                            <option value="yes">Sí</option>
                        </select>
                    </div>
                </div>

                <div id="sheet-status" class="text-center p-3 mt-4 rounded-lg text-sm hidden"></div>

                <button id="calculate-button" class="w-full mt-4 py-3 px-6 border border-transparent rounded-lg shadow-glow text-lg font-medium text-white ipn-bg hover:bg-red-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-150 ease-in-out">
                    Calcular Riesgo Cardiovascular Integral
                </button>
            </div>
        </form>

        <div id="results-section" class="hidden mt-10">
            <h2 class="text-3xl font-bold ipn-accent mb-6 border-b-4 ipn-border pb-3">4. Resultados y Plan de Acción</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">

                <div class="p-6 rounded-xl border-2 space-y-4">
                    <h3 class="text-xl font-semibold mb-3 ipn-accent">Perfil de Riesgo</h3>
                    <div id="global-risk-result" class="text-center p-4 rounded-lg font-bold text-2xl mb-4 transition duration-300"></div>
                   
                    <div>
                        <h4 class="font-semibold text-gray-700">Métricas Antropométricas:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-600">
                            <li><span class="font-medium">Edad:</span> <span id="res-age"></span> años</li>
                            <li><span class="font-medium">IMC:</span> <span id="res-bmi-val"></span> <span id="res-bmi-class" class="font-bold"></span></li>
                            <li><span class="font-medium">Índice Cintura-Cadera (ICC):</span> <span id="res-icc-val"></span> <span id="res-icc-class" class="font-bold"></span></li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-semibold text-gray-700">Métricas Bioquímicas (Índices):</h4>
                        <ul class="list-disc list-inside text-sm text-gray-600">
                            <li><span class="font-medium">Índice TG/HDL:</span> <span id="res-tg-hdl-val"></span> <span id="res-tg-hdl-class" class="font-bold"></span></li>
                            <li><span class="font-medium">Índice Col Total/HDL:</span> <span id="res-chol-hdl-val"></span> <span id="res-chol-hdl-class" class="font-bold"></span></li>
                            <li><span class="font-medium">MASLD (FLI Score):</span> <span id="res-fli-val"></span> <span id="res-fli-class" class="font-bold"></span></li>
                        </ul>
                    </div>

                    <div>
                        <h4 class="font-semibold text-gray-700">Estilo de Vida y Fuerza:</h4>
                        <ul class="list-disc list-inside text-sm text-gray-600">
                            <li><span class="font-medium">Índice Tabáquico (IPA):</span> <span id="res-ipa-val"></span> <span id="res-ipa-class" class="font-bold"></span></li>
                            <li><span class="font-medium">Actividad Física:</span> <span id="res-activity-class" class="font-bold"></span></li>
                            <li><span class="font-medium">Fuerza de Agarre:</span> <span id="res-grip-class" class="font-bold"></span></li>
                        </ul>
                    </div>
                </div>

                <div class="space-y-6">
                    <div class="p-6 rounded-xl border-2 bg-gray-50">
                        <h3 class="text-xl font-semibold mb-3 ipn-accent">Factores Clave</h3>
                        <ul id="risk-factors-list" class="space-y-2 text-sm text-gray-700">
                            </ul>
                    </div>

                    <div class="p-6 rounded-xl border-2 border-green-500 bg-green-50">
                        <h3 class="text-2xl font-bold mb-4 text-green-700">Plan de Acción Personalizado</h3>
                        <ul id="recommendations-list" class="space-y-3 text-gray-800 list-disc ml-5">
                            </ul>
                    </div>
                </div>
            </div>

            <div class="mt-8 no-print">
                <button id="print-button" class="w-full py-2 px-4 border border-blue-600 rounded-lg shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 transition duration-150 ease-in-out">
                    Imprimir Reporte (PDF)
                </button>
            </div>

            <div class="mt-8 text-center border-t pt-4">
                <p class="text-xs text-gray-500 italic">**Nota Importante:** Esta herramienta es parte de un proyecto de tesis y no sustituye la evaluación médica profesional. Consulte a su médico para un diagnóstico y tratamiento precisos.</p>
            </div>
        </div>

        <div class="border-t pt-4 mt-8 no-print"></div> 
        <div id="project-info" class="p-4 bg-gray-50 rounded-lg text-sm no-print">
             <h3 class="font-bold text-lg ipn-accent mb-2 border-b pb-1">Información del Proyecto y Colaboradores</h3>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                 <div>
                     <p class="font-semibold text-gray-700">Presenta y Asesoría:</p>
                     <p class="text-gray-600"><strong>Edsel Yahvi Méndez Hernández</strong></p>
                     <p class="text-gray-600">Asesora Externa: Dra. Nayelli Nájera García</p>
                     <p class="text-gray-600">Asesor Interno (Docente): Dr. Bustos García Juan Roberto Israel</p>
                     <p class="font-semibold text-gray-700 mt-2">Institución:</p>
                     <p class="text-gray-600">
                         <a href="https://www.esm.ipn.mx/" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                              Escuela Superior de Medicina (ESM) - IPN
                         </a>
                     </p>
                 </div>
                 <div>
                     <p class="font-semibold text-gray-700">Laboratorio Colaborador (LICAM):</p>
                     <p class="text-gray-600">Investigación Integral Cardiometabólica (IPN)</p>
                     
                     <p class="font-semibold text-gray-700 mt-2">Contacto y Ubicación:</p>
                     <p class="text-gray-600">
                         <span class="font-medium">Ubicación:</span> Plan de San Luis y Díaz Mirón s/n Col. Casco de Santo Tomás, Miguel Hidalgo, 11340, Ciudad de México, CDMX.
                     </p>
                     <p class="text-gray-600">
                         <span class="font-medium">Correo:</span> nnajerag@ipn.mx
                     </p>
                     <p class="text-gray-600">
                         <span class="font-medium">Teléfono:</span> 55 5729 6300 ext 62820
                     </p>
                     <p class="text-gray-600 mt-2">
                         <span class="font-medium">Sitio Web/Redes:</span> 
                         <a href="cemiztli.wixsite.com/cardiometabolismo" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                             cemiztli.wixsite.com/cardiometabolismo
                         </a>,
                         <a href="https://www.facebook.com/licam.ipn" target="_blank" class="ipn-accent hover:text-red-800 font-semibold underline">
                             Facebook
                         </a>,
                         <a href="https://www.instagram.com/ipn_licam_lab" target="_blank" class="text-pink-600 hover:text-pink-800 font-semibold underline">
                             Instagram
                         </a>
                     </p>
                 </div>
             </div>
        </div>
    </div>

    <button type="button" id="reset-button" class="mt-4 py-2 px-4 border ipn-border rounded-lg shadow-sm text-sm font-medium ipn-accent bg-white hover:bg-red-50 transition duration-150 ease-in-out fixed top-8 right-8 hidden no-print">
        &larr; Calcular Nuevo
    </button>


    <script>
        // =======================================================
        // === CALCULADORA DE RIESGO INTEGRAL V2 - LOGIC.JS ====
        // =======================================================
       
        // --- CONFIGURACIÓN DE INTEGRACIÓN CON GOOGLE SHEETS (IMPORTANTE) ---
        // ¡ACTUALIZADO CON TU ÚLTIMA URL DE DESPLIEGUE!
        const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbweuEciVBAMuQgFMJe6HQrH4Q3v4aAKyhlZUr45lAIiZCseb095Hy8ljd2NDOvv42ODIw/exec";
        // --------------------------------------------------------------------
       
        // --- CONSTANTES GLOBALES Y PUNTOS DE CORTE (Basados en IMSS y Guías) ---
        const CONSTANTS = {
            // IMSS (1000167606.jpg)
            IMC: {
                NORMAL: 25,
                SOBREPESO: 30,
                OBESIDAD_I: 35
            },
            GLUCOSA: {
                NORMAL: 100,
                PREDIABETES: 126
            },
            HBA1C: { // Añadido desde guías estándar
                NORMAL: 5.7,
                PREDIABETES: 6.5
            },
            TRIGLICERIDOS: {
                NORMAL: 150,
                LIMITE: 200
            },
            COLESTEROL_TOTAL: {
                NORMAL: 200,
                LIMITE: 240
            },
            HDL_HOMBRES: {
                NORMAL: 40 // Riesgo si < 40
            },
            HDL_MUJERES: {
                NORMAL: 50 // Riesgo si < 50
            },
            LDL: { // Añadido desde guías estándar
                NORMAL: 100,
                LIMITE: 130,
                ALTO: 160
            },
            CINTURA_HOMBRES: {
                NORMAL: 90 // Riesgo si >= 90
            },
            CINTURA_MUJERES: {
                NORMAL: 80 // Riesgo si >= 80
            },
            // Guías Estándar (No en las imágenes)
            ICC_HOMBRES: { // Índice Cintura-Cadera
                RIESGO_ALTO: 0.95 // > 0.95 es Riesgo Alto en hombres
            },
            ICC_MUJERES: {
                RIESGO_ALTO: 0.85 // > 0.85 es Riesgo Alto en mujeres
            },
            INDICE_TG_HDL: { // Triglicéridos / HDL
                ALTO_RIESGO: 3.5 // > 3.5 sugiere alta Resistencia a Insulina
            },
            INDICE_COL_HDL: { // Colesterol Total / HDL
                ALTO_RIESGO: 5.0 // > 5.0 es Alto Riesgo
            },
            IPA: { // Índice Paquete-Año
                RIESGO_LEVE: 10
            },
            FLI_MASLD: { // Fatty Liver Index
                BAJO: 30,
                ALTO: 60
            }
        };

        // --- TABLA DE DINAMOMETRÍA (1000167605.jpg) ---
        const DYNAMOMETRY_P10 = {
            hombres: {
                "20-29": 33.9, 
                "30-39": 36.6,
                "40-49": 34.3,
                "50-59": 30.2,
                "60-69": 26.5,
                "70-99": 22.8, 
            },
            mujeres: {
                "20-29": 19.5,
                "30-39": 20.7,
                "40-49": 19.8,
                "50-59": 16.6,
                "60-69": 19.6, 
                "70-99": 13.0, 
            }
        };

        /**
         * Función Principal: Se ejecuta cuando se presiona el botón "Calcular"
         */
        async function calculateRisk_v2() {
            const validationDiv = document.getElementById('validation-message');
            validationDiv.classList.add('hidden');
            document.getElementById('sheet-status').classList.add('hidden');
           
            console.log("Iniciando cálculo y envío de datos v2...");
           
            // 1. Recolección y Cálculos de Edad
            const inputs = getUserInputs_v2();
            if (!inputs) {
                validationDiv.textContent = "⚠️ Por favor, complete todos los campos obligatorios (Sección 1-4) con valores numéricos válidos (ej: edad, peso, estatura, glucosa, PAS/PAD).";
                validationDiv.classList.remove('hidden');
                return;
            }

            // 2. Cálculos de Métricas Automáticas (IMC, ICC, Índices, etc.)
            const metrics = calculateMetrics(inputs);

            // 3. Chequeo de Comorbilidades (Lógica de Diagnóstico vs Medicamento)
            const healthStatus = checkComorbidities(inputs);

            // 4. Cálculo del Score de Riesgo Heurístico (El "Cerebro")
            const riskProfile = calculateHeuristicScore_v2(inputs, metrics, healthStatus);
           
            // 5. Envío de Datos a Google Sheets (Asíncrono)
            await sendDataToSheets(inputs, metrics, riskProfile);
           
            // 6. Generación de Resultados en la UI
            generateResults_v2(inputs, metrics, riskProfile);
           
            // 7. Guardar resultados en variable global para 'copiar'
            window.lastResultData_v2 = { inputs, metrics, riskProfile };

            // 8. Ocultar formulario y mostrar resultados
            document.getElementById('input-form').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            document.getElementById('reset-button').classList.remove('hidden');
            window.scrollTo(0, 0);

            console.log("Cálculo finalizado. Perfil de Riesgo:", riskProfile);
        }

        /**
         * PASO 5.1: Envía los datos de entrada y resultados calculados a Google Sheets.
         */
        async function sendDataToSheets(inputs, metrics, riskProfile) {
            const statusDiv = document.getElementById('sheet-status');
            statusDiv.textContent = "Enviando datos a la base de datos (Google Sheets)...";
            statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-blue-100 text-blue-800";
            statusDiv.classList.remove('hidden');
           
            // Consolidar todos los datos relevantes en un solo objeto para el POST
            const dataToSend = {
                timestamp: new Date().toLocaleString('es-MX', { timeZone: 'America/Mexico_City' }),
                fullName: inputs.full_name || 'Sin nombre',
                email: inputs.email || '',
                gender: inputs.gender === 'male' ? 'Masculino' : 'Femenino',
                age: inputs.age,
               
                // Signos y Antropometría
                paSistolica: inputs.pa_used.s,
                paDiastolica: inputs.pa_used.d,
                paSource: inputs.pa_used.source,
                hr: inputs.hr || '',
                rr: inputs.rr || '',
                weight: inputs.weight,
                height_cm: inputs.height_cm,
                waist: inputs.waist,
                hip: inputs.hip,
               
                // Métricas calculadas
                bmi: metrics.bmi,
                bmiClass: metrics.bmi_class,
                icc: metrics.icc,
                iccClass: metrics.icc_class,
                fliScore: metrics.fli_score,
                fliClass: metrics.fli_class,
                gripFactorText: riskProfile.grip_factor_text,

                // Bioquímicos
                glucose: inputs.glucose,
                hba1c: inputs.hba1c || '',
                totalChol: inputs.total_chol,
                hdl: inputs.hdl,
                ldl: inputs.ldl || '',
                triglycerides: inputs.triglycerides,
                tgHdlIndex: metrics.tg_hdl,
                cholHdlIndex: metrics.chol_hdl,

                // Estilo de Vida
                activity: `${inputs.activity_days} días/${inputs.activity_duration || 0} min (${inputs.activity_intensity})`,
                smokerStatus: inputs.smoker_status,
                ipaScore: metrics.ipa,
                alcoholFreq: inputs.alcohol_freq,

                // Comorbilidades
                dmStatus: inputs.dm_status,
                medDm: inputs.med_dm,
                htaStatus: inputs.hta_status,
                medHta: inputs.med_hta,
                dlpStatus: inputs.dlp_status,
                medDlp: inputs.med_dlp,
                historyMI: inputs.history_mi,
                familyHistory: inputs.family_history,
               
                // Resultados de Riesgo
                riskScore: riskProfile.score,
                riskLevel: riskProfile.level,
                riskFactorsList: riskProfile.factors.map(f => f.text).join(' | '),
            };
           
            try {
                // Usamos fetch con 'no-cors' para Apps Script POST
                const response = await fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'no-cors', 
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dataToSend)
                });
               
                // Asumimos éxito debido a 'no-cors'.
                statusDiv.textContent = "✅ Datos guardados en Sheets con éxito.";
                statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-green-100 text-green-800";
               
            } catch (error) {
                console.error("Error al enviar datos a Google Sheets. La aplicación local sigue funcionando.", error);
                statusDiv.textContent = "❌ Error al guardar datos en Sheets. Revise la consola. El cálculo local se completó.";
                statusDiv.className = "text-center p-3 mt-4 rounded-lg text-sm bg-red-100 text-red-800";
            }
        }


        /**
         * PASO 1: Recolecta todos los datos del formulario HTML.
         */
        function getUserInputs_v2() {
           
            const getVal = (id) => document.getElementById(id)?.value || null;
            const getNum = (id) => parseFloat(document.getElementById(id)?.value) || null;
            const getRad = (name) => document.querySelector(`input[name="${name}"]:checked`)?.value || "no";

            // --- Helper: Calcular Edad ---
            const getAge = (birthDateString) => {
                if (!birthDateString) return null;
                const today = new Date();
                const birthDate = new Date(birthDateString);
                let age = today.getFullYear() - birthDate.getFullYear();
                const m = today.getMonth() - birthDate.getMonth();
                if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                return age;
            };

            const inputs = {
                // Sección 1
                full_name: getVal('full_name'),
                birth_date: getVal('birth_date'),
                age: getAge(getVal('birth_date')),
                gender: getVal('gender'),
                email: getVal('email'),
                // Sección 2
                hr: getNum('hr'),
                rr: getNum('rr'),
                grip_right: getNum('grip_right'),
                grip_left: getNum('grip_left'),
                // Sección 2.1 - Promedio de PA
                pa_used: getAverageBP(getNum('pas'), getNum('pad')),
                // Sección 3
                height_cm: getNum('height'),
                weight: getNum('weight'),
                waist: getNum('waist'),
                hip: getNum('hip'),
                // Sección 4
                glucose: getNum('glucose'),
                hba1c: getNum('hba1c'),
                total_chol: getNum('total_chol'),
                hdl: getNum('hdl'),
                ldl: getNum('ldl'),
                triglycerides: getNum('triglycerides'),
                // Sección 5 (BIA) - No se usan para el cálculo principal, solo para logging si se
